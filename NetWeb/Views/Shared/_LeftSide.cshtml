@using NetWeb.Models
@model Tuple<TestbedViewModel, EventTypeViewModel, EventTypeViewModel, DateSelectModel>

@Styles.Render("~/Content/css")
@Scripts.Render("~/bundles/modernizr")
@Scripts.Render("~/bundles/jquery")
@Scripts.Render("~/bundles/bootstrap")


<script src="http://ajax.googleapis.com/ajax/libs/jqueryui/1.8/jquery-ui.min.js"></script>
<script src="~/Scripts/jquery-ui-1.12.1.min.js"></script>
<link href="https://code.jquery.com/ui/1.11.4/themes/smoothness/jquery-ui.css" rel="stylesheet" type="text/css">
<script language="javascript" type="text/javascript">

    function filterEvents() {
        var eventTypeId = $('#Item2_EventTypeId').val();

        $.ajax({
            url: 'Details',
            type: "GET",
            dataType: "JSON",
            data: { MasterEventId: eventTypeId },
            success: function (SubEventTypes) {
                $('#idSubEvent').html("");

                var jsondata = SubEventTypes;

                $.each(jsondata, function (i, item) {
                    $('#idSubEvent').append($('<option>', {
                        value: item.Value,
                        text: item.Text
                    }));
                });

            }
        })
    }

    function FetchStatistics() {

        var selectObject = new Object();
        selectObject.ValueA = "Anders"
        selectObject.ValueB = "Olof"
        selectObject.ValueC = "Selborn"

        $.ajax({
            url: 'Data',
            type: "POST",
            dataType: "JSON",
            data: JSON.stringify(selectObject),
            success: function (SubEventTypes) {
                alert('ok');

            }
        })


    }

    


    $(function () {
        $("#FromDate,#TomDate").datepicker({
            changeMonth: true,
            changeYear: true,
            dateFormat: 'yy-mm-dd'
        });

        $("#datepicker-1").datepicker({
            dateFormat: "yyyy-MM-dd",
            changeMonth: true,
            changeYear: true
        });
    })

    function AllEventsSelected(element) {
        //element.checked ? alert('checked.') : alert('not checked');
        //allEvents.checked = element.checked ? true : false;
        var checked = element.checked ? true : false;
        $('#IsAllEvents').val(checked);
    }

</script>



@using (Html.BeginForm("Data", "Statistics", FormMethod.Post))
{

    <div class="divstyle">
        <h3>Select statistics</h3>

        <div class="form-group">
            @Html.LabelFor(tuple => tuple.Item1.TestBedId, new { @class = "control-label" })

            @*@Html.DropDownListFor(tuple => tuple.Item1.TestBedId, (Model.Item1.ListofTestbeds), "--SELECT--");*@
            @Html.DropDownListFor(tuple => tuple.Item1.TestBedId, new SelectList(Model.Item1.ListofTestbeds, "Value", "Text"),
          "--SELECT--", new { @class = "form-control" })



        </div>

        <div class="form-group">

            @Html.LabelFor(tuple => tuple.Item2.EventTypeId)
            @Html.DropDownListFor(tuple => tuple.Item2.EventTypeId, new SelectList(Model.Item2.ListofEventTypes, "Value", "Text"),
          "--SELECT--",
          new { @class = "form-control", @onchange = "filterEvents();" })

        </div>

        <div class="form-inline">

            <select name="ddlSubEvent" class="form-control" id="idSubEvent">
                <option>--SUB-EVENTTYPE--</option>
            </select>

            @Html.CheckBox("chkSubEventTypes", false, new { @class = "control-label", onchange = "AllEventsSelected(this);" })
            @Html.Label("All subevents")

        </div>

        <div class="form-group input-group-sm">

            @Html.LabelFor(model => model.Item4.FromDate)
            @*@Html.TextBoxFor(model => model.Item4.FromDate, "{0:yyyy-MM-dd}", new { @class = "form-control FromDate " })*@
            @*@Html.TextBoxFor(model => model.Item4.FromDate, new { htmlAttributes = new { @class = "datepicker" } })*@
            @Html.TextBoxFor(model => model.Item4.FromDate, "{0:yyyy-MM-dd}", new { @id = "FromDate", @class = "form-control" })



            @Html.LabelFor(model => model.Item4.TomDate)
            @Html.TextBoxFor(model => model.Item4.TomDate, "{0:yyyy-MM-dd}", new { @class = "form-control", @id = "TomDate" })
            <br />

            <fieldset>
                <legend>Select grouping option</legend>
                @Html.RadioButton("group", "Year", false, new { @class = "control-label", @value = "1" }) Year<br />
                @Html.RadioButton("group", "Month", true, new { @class = "control-label", @value = "2" }) Month<br />
                @Html.RadioButton("group", "Week", false, new { @class = "control-label", @value = "3" }) Week<br />
                @Html.RadioButton("group", "Day", false, new { @class = "control-label", @value = "4" }) Day<br /><br />
                <legend />
            </fieldset>
            @*<input type="submit" name="btnSubmit" id="idSubmit" value="Get Data" class="btn-info" />*@
            @*<input type="button" onclick="FetchStatistics();" name="btnSubmit" id="idSubmit" value="Get Data" class="btn-info" />*@
            @*<input type="button" class="btn btn-info" value="Let's Go!" onclick="location.href='@Url.Action("Stat", "Statistics")'" />*@
            @*@Html.ActionLink("Select statistics", "Stat", new { }, new { @id = "fetchStat" })*@
            <input type="submit" value="Fetch!" name="btn" id="btnClick" />

            @section Scripts {
                <script type="text/javascript">
                    $(document).ready(function () {
                        $("#btnClick").click(function (e) {
                            var myUser = {};
                            var filterParameters = {};

                            filterParameters.StartDate = '2018-01-01';
                            filterParameters.StopDate = '2018-10-31';
                            filterParameters.TestBedId = '1';
                            filterParameters.WithGrouping = true;
                            filterParameters.EventTypeId = '4';

                            
                            $.ajax({
                                url: '@Url.Action("Data", "Statistics")',
                                type: "GET",
                                data: '{data: ' + JSON.stringify(filterParameters) + '}',
                                contentType: "application/json; charset=utf-8",
                                dataType: "json",
                                success: function (response) {
                                    alert("Success");
                                },
                                error: function (xhr, status, error) {
                                    alert('failed.');
                                }
                                
                            });
                        });
                    });
                </script>
           }
        </div>

    </div>

}



<style>
    .divstyle {
        padding-left: 15px;
        float: left;
        width: 350px;
        height: 700px;
        background-color: darkgoldenrod;
    }
</style>
